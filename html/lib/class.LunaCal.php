<?php
/* vim: set expandtab tabstop=4 shiftwidth=4 foldmethod=marker: */
/**
* ÆÄÀÏ¸í: class.LunaCal.php
* ÀÛ¼ºÀÏ: 2004-11-22
* ÀÛ¼ºÀÚ: °ÅÄ£¸¶·ç
* ¼³  ¸í: ¾çÀ½·Â º¯È¯
*****************************************************************
* 
*/

class LunaCal
{
	var $map = array(
		//1841³â ~ 1900³â
		1,2,4,1,1,2,1,2,1,2,2,1,    2,2,1,2,1,1,2,1,2,1,2,1,    2,2,2,1,2,1,4,1,2,1,2,1,    2,2,1,2,1,2,1,2,1,2,1,2,    1,2,1,2,2,1,2,1,2,1,2,1,
		2,1,2,1,5,2,1,2,2,1,2,1,    2,1,1,2,1,2,1,2,2,2,1,2,    1,2,1,1,2,1,2,1,2,2,2,1,    2,1,2,3,2,1,2,1,2,1,2,2,    2,1,2,1,1,2,1,1,2,2,1,2,
		2,2,1,2,1,1,2,1,2,1,5,2,    2,1,2,2,1,1,2,1,2,1,1,2,    2,1,2,2,1,2,1,2,1,2,1,2,    1,2,1,2,1,2,5,2,1,2,1,2,    1,1,2,1,2,2,1,2,2,1,2,1,
		2,1,1,2,1,2,1,2,2,2,1,2,    1,2,1,1,5,2,1,2,1,2,2,2,    1,2,1,1,2,1,1,2,2,1,2,2,    2,1,2,1,1,2,1,1,2,1,2,2,    2,1,6,1,1,2,1,1,2,1,2,2,
		1,2,2,1,2,1,2,1,2,1,1,2,    2,1,2,1,2,2,1,2,2,3,1,2,    1,2,2,1,2,1,2,2,1,2,1,2,    1,1,2,1,2,1,2,2,1,2,2,1,    2,1,1,2,4,1,2,2,1,2,2,1,
		2,1,1,2,1,1,2,2,1,2,2,2,    1,2,1,1,2,1,1,2,1,2,2,2,    1,2,2,3,2,1,1,2,1,2,2,1,    2,2,2,1,1,2,1,1,2,1,2,1,    2,2,2,1,2,1,2,1,1,5,2,1,
		2,2,1,2,2,1,2,1,2,1,1,2,    1,2,1,2,2,1,2,1,2,2,1,2,    1,1,2,1,2,4,2,1,2,2,1,2,    1,1,2,1,2,1,2,1,2,2,2,1,    2,1,1,2,1,1,2,1,2,2,2,1,
		2,2,1,1,5,1,2,1,2,2,1,2,    2,2,1,1,2,1,1,2,1,2,1,2,    2,2,1,2,1,2,1,1,2,1,2,1,    2,2,4,2,1,2,1,1,2,1,2,1,    2,1,2,2,1,2,2,1,2,1,1,2,
		1,2,1,2,1,2,5,2,2,1,2,1,    1,2,1,2,1,2,1,2,2,1,2,2,    1,1,2,1,1,2,1,2,2,2,1,2,    2,1,1,2,3,2,1,2,2,1,2,2,    2,1,1,2,1,1,2,1,2,1,2,2,
		2,1,2,1,2,1,1,2,1,2,1,2,    2,2,1,5,2,1,1,2,1,2,1,2,    2,1,2,2,1,2,1,1,2,1,2,1,    2,1,2,2,1,2,1,2,1,2,1,2,    1,5,2,1,2,2,1,2,1,2,1,2,
		1,2,1,2,1,2,1,2,2,1,2,2,    1,1,2,1,1,5,2,2,1,2,2,2,    1,1,2,1,1,2,1,2,1,2,2,2,    1,2,1,2,1,1,2,1,2,1,2,2,    2,1,2,1,5,1,2,1,2,1,2,1,
		2,2,2,1,2,1,1,2,1,2,1,2,    1,2,2,1,2,1,2,1,2,1,2,1,    2,1,5,2,2,1,2,1,2,1,2,1,    2,1,2,1,2,1,2,2,1,2,1,2,    1,2,1,1,2,1,2,5,2,2,1,2,

		//1901³â ~ 2000³â
		1,2,1,1,2,1,2,1,2,2,2,1,    2,1,2,1,1,2,1,2,1,2,2,2,    1,2,1,2,3,2,1,1,2,2,1,2,    2,2,1,2,1,1,2,1,1,2,2,1,    2,2,1,2,2,1,1,2,1,2,1,2,
		1,2,2,4,1,2,1,2,1,2,1,2,    1,2,1,2,1,2,2,1,2,1,2,1,    2,1,1,2,2,1,2,1,2,2,1,2,    1,5,1,2,1,2,1,2,2,2,1,2,    1,2,1,1,2,1,2,1,2,2,2,1,
		2,1,2,1,1,5,1,2,2,1,2,2,    2,1,2,1,1,2,1,1,2,2,1,2,    2,2,1,2,1,1,2,1,1,2,1,2,    2,2,1,2,5,1,2,1,2,1,1,2,    2,1,2,2,1,2,1,2,1,2,1,2,
		1,2,1,2,1,2,2,1,2,1,2,1,    2,3,2,1,2,2,1,2,2,1,2,1,    2,1,1,2,1,2,1,2,2,2,1,2,    1,2,1,1,2,1,5,2,2,1,2,2,    1,2,1,1,2,1,1,2,2,1,2,2,
		2,1,2,1,1,2,1,1,2,1,2,2,    2,1,2,2,3,2,1,1,2,1,2,2,    1,2,2,1,2,1,2,1,2,1,1,2,    2,1,2,1,2,2,1,2,1,2,1,1,    2,1,2,5,2,1,2,2,1,2,1,2,
		1,1,2,1,2,1,2,2,1,2,2,1,    2,1,1,2,1,2,1,2,2,1,2,2,    1,5,1,2,1,1,2,2,1,2,2,2,    1,2,1,1,2,1,1,2,1,2,2,2,    1,2,2,1,1,5,1,2,1,2,2,1,
		2,2,2,1,1,2,1,1,2,1,2,1,    2,2,2,1,2,1,2,1,1,2,1,2,    1,2,2,1,6,1,2,1,2,1,1,2,    1,2,1,2,2,1,2,2,1,2,1,2,    1,1,2,1,2,1,2,2,1,2,2,1,
		2,1,4,1,2,1,2,1,2,2,2,1,    2,1,1,2,1,1,2,1,2,2,2,1,    2,2,1,1,2,1,4,1,2,2,1,2,    2,2,1,1,2,1,1,2,1,2,1,2,    2,2,1,2,1,2,1,1,2,1,2,1,
		2,2,1,2,2,4,1,1,2,1,2,1,    2,1,2,2,1,2,2,1,2,1,1,2,    1,2,1,2,1,2,2,1,2,2,1,2,    1,1,2,4,1,2,1,2,2,1,2,2,    1,1,2,1,1,2,1,2,2,2,1,2,
		2,1,1,2,1,1,2,1,2,2,1,2,    2,5,1,2,1,1,2,1,2,1,2,2,    2,1,2,1,2,1,1,2,1,2,1,2,    2,2,1,2,1,2,3,2,1,2,1,2,    2,1,2,2,1,2,1,1,2,1,2,1,
		2,1,2,2,1,2,1,2,1,2,1,2,    1,2,1,2,4,2,1,2,1,2,1,2,    1,2,1,1,2,2,1,2,2,1,2,2,    1,1,2,1,1,2,1,2,2,1,2,2,    2,1,4,1,1,2,1,2,1,2,2,2,
		1,2,1,2,1,1,2,1,2,1,2,2,    2,1,2,1,2,1,1,5,2,1,2,2,    1,2,2,1,2,1,1,2,1,2,1,2,    1,2,2,1,2,1,2,1,2,1,2,1,    2,1,2,1,2,5,2,1,2,1,2,1,
		2,1,2,1,2,1,2,2,1,2,1,2,    1,2,1,1,2,1,2,2,1,2,2,1,    2,1,2,3,2,1,2,1,2,2,2,1,    2,1,2,1,1,2,1,2,1,2,2,2,    1,2,1,2,1,1,2,1,1,2,2,1,
		2,2,5,2,1,1,2,1,1,2,2,1,    2,2,1,2,2,1,1,2,1,2,1,2,    1,2,2,1,2,1,5,2,1,2,1,2,    1,2,1,2,1,2,2,1,2,1,2,1,    2,1,1,2,2,1,2,1,2,2,1,2,
		1,2,1,1,5,2,1,2,2,2,1,2,    1,2,1,1,2,1,2,1,2,2,2,1,    2,1,2,1,1,2,1,1,2,2,2,1,    2,2,1,5,1,2,1,1,2,2,1,2,    2,2,1,2,1,1,2,1,1,2,1,2,
		2,2,1,2,1,2,1,5,2,1,1,2,    2,1,2,2,1,2,1,2,1,2,1,1,    2,2,1,2,1,2,2,1,2,1,2,1,    2,1,1,2,1,6,1,2,2,1,2,1,    2,1,1,2,1,2,1,2,2,1,2,2,
		1,2,1,1,2,1,1,2,2,1,2,2,    2,1,2,3,2,1,1,2,2,1,2,2,    2,1,2,1,1,2,1,1,2,1,2,2,    2,1,2,2,1,1,2,1,1,5,2,2,    1,2,2,1,2,1,2,1,1,2,1,2,
		1,2,2,1,2,2,1,2,1,2,1,1,    2,1,2,2,1,5,2,2,1,2,1,2,    1,1,2,1,2,1,2,2,1,2,2,1,    2,1,1,2,1,2,1,2,2,1,2,2,    1,2,1,1,5,1,2,1,2,2,2,2,
		1,2,1,1,2,1,1,2,1,2,2,2,    1,2,2,1,1,2,1,1,2,1,2,2,    1,2,5,2,1,2,1,1,2,1,2,1,    2,2,2,1,2,1,2,1,1,2,1,2,    1,2,2,1,2,2,1,5,2,1,1,2,
		1,2,1,2,2,1,2,1,2,2,1,2,    1,1,2,1,2,1,2,2,1,2,2,1,    2,1,1,2,3,2,2,1,2,2,2,1,    2,1,1,2,1,1,2,1,2,2,2,1,    2,2,1,1,2,1,1,2,1,2,2,1,

		//2001³â ~ 2043³â
		2,2,2,3,2,1,1,2,1,2,1,2,    2,2,1,2,1,2,1,1,2,1,2,1,    2,2,1,2,2,1,2,1,1,2,1,2,    1,5,2,2,1,2,1,2,1,2,1,2,    1,2,1,2,1,2,2,1,2,2,1,1,
		2,1,2,1,2,1,5,2,2,1,2,2,    1,1,2,1,1,2,1,2,2,2,1,2,    2,1,1,2,1,1,2,1,2,2,1,2,    2,2,1,1,5,1,2,1,2,1,2,2,    2,1,2,1,2,1,1,2,1,2,1,2,
		2,1,2,2,1,2,1,1,2,1,2,1,    2,1,6,2,1,2,1,1,2,1,2,1,    2,1,2,2,1,2,1,2,1,2,1,2,    1,2,1,2,1,2,1,2,5,2,1,2,    1,2,1,1,2,1,2,2,2,1,2,2,
		1,1,2,1,1,2,1,2,2,1,2,2,    2,1,1,2,3,2,1,2,1,2,2,2,    1,2,1,2,1,1,2,1,2,1,2,2,    2,1,2,1,2,1,1,2,1,2,1,2,    2,1,2,5,2,1,1,2,1,2,1,2,
		1,2,2,1,2,1,2,1,2,1,2,1,    2,1,2,1,2,2,1,2,1,2,1,2,    1,5,2,1,2,1,2,2,1,2,1,2,    1,2,1,1,2,1,2,2,1,2,2,1,    2,1,2,1,1,5,2,1,2,2,2,1,
		2,1,2,1,1,2,1,2,1,2,2,2,    1,2,1,2,1,1,2,1,1,2,2,2,    1,2,2,1,5,1,2,1,1,2,2,1,    2,2,1,2,2,1,1,2,1,1,2,2,    1,2,1,2,2,1,2,1,2,1,2,1,
		2,1,5,2,1,2,2,1,2,1,2,1,    2,1,1,2,1,2,2,1,2,2,1,2,    1,2,1,1,2,1,5,2,2,2,1,2,    1,2,1,1,2,1,2,1,2,2,2,1,    2,1,2,1,1,2,1,1,2,2,1,2,
		2,2,1,2,1,4,1,1,2,1,2,2,    2,2,1,2,1,1,2,1,1,2,1,2,    2,2,1,2,1,2,1,2,1,1,2,1,    2,2,1,2,5,2,1,2,1,2,1,1,    2,1,2,2,1,2,2,1,2,1,2,1,
		2,1,1,2,1,2,2,1,2,2,1,2,    1,5,1,2,1,2,1,2,2,2,1,2,    1,2,1,1,2,1,1,2,2,1,2,2
	);

	var $gan = array("°©","À»","º´","Á¤","¹«","±â","°æ","½Å","ÀÓ","°è");
	var $hgan = array("Ë£","ëà","Ü°","ïË","Ùæ","Ðù","ÌÒ","ãô","ìó","Í¤");
	var $jee = array("ÀÚ","Ãà","ÀÎ","¹¦","Áø","»ç","¿À","¹Ì","½Å","À¯","¼ú","ÇØ");
	var $hjee = array("í­","õä","ìÙ","ÙÖ","òã","ÞÓ","çí","Ú±","ãé","ë·","âù","ú¤");
	var $ddi = array("Áã","¼Ò","È£¶ûÀÌ","Åä³¢","¿ë","¹ì","¸»","¾ç","¿ø¼þÀÌ","´ß","°³","µÅÁö");
	var $md  = array(31, 0, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);
	var $week = array("ÀÏ","¿ù","È­","¼ö","¸ñ","±Ý","Åä");

	function LunaCal()
	{
	}

	function febdays($sy) {
		if(($sy%100 != 0 && $sy%4 ==0) || $sy%400 ==0) $md[1] = 29;
		else $md[1] = 28;
		return array($md[1]);
	}

	function alltd($sy) {
		$td = 0;
		for($i=1841;$i<=$sy-1;$i++) {
			list($this->md[1]) = $this->febdays($i);
			for($j=0;$j<12;$j++) {
				$td += $this->md[$j];
				$ttd[$i][12] += $this->md[$j];
			}
		}
		$td -= 22;
		return array($td);
	}

	function sol2lun($sy, $sm, $sd) {

		list($td) = $this->alltd($sy);
		list($this->md[1]) = $this->febdays($sy);
		for($i=0;$i<$sm-1;$i++) $td += $this->md[$i];
		$td += $sd;
		$i = 0;
		$temptd = $td;
		while($temptd>0) {
			$yoon = "";
			switch($this->map[$i]) {
				case 1 :
					$mm = 29;
					break;
				case 2 :
					$mm = 30;
					break;
				case 3 :
					$mm = 29;
					$ymm = 29;
					if($temptd > 29) {
						$temptd -= 29;
						$yoon = "(À±´Þ)";
					}
					break;
						case 4 :
					$mm = 29;
					$ymm = 30;
					if($temptd > 30) {
						$temptd -= 30;
						$yoon = "(À±´Þ)";
					}
					break;
						case 5 :
					$mm = 30;
					$ymm = 29;
					if($temptd > 29) {
						$temptd -= 29;
						$yoon = "(À±´Þ)";
					}
					break;
				case 6 :
					$mm = 30;
					$ymm = 30;
					if($temptd > 30) {
						$temptd -= 30;
						$yoon = "(À±´Þ)";
					}
					break;
			}
			$temptd -=$mm;

			$i++;
			if($i%12 == 1) $ly += 1;
		}
		if($temptd <= 0) {
			if($yoon=="(À±´Þ)") $temptd += $ymm;
			else $temptd +=$mm;
		}    
		$ly += 1840;
		$lm = $i % 12;
		if($lm==0) $lm=12;
		$ld = $temptd;
		$k1 = ($ly+6) % 10;
		$k2 = ($ly+8) % 12;
		$i = ($td+2) % 10;
		$j = ($td+10) % 12;
		$w = ($td+5) % 7;
		return array(
			'year' => $ly,
			'month' => $lm,
			'day' => $ld,
			'gan' => $this->hgan[$k1],
			'jee' => $this->hjee[$k2],
//			$i,
//			$j,
			'weekday' => $w,
			'yoon' => $yoon
		);
	}


	function lun2sol($ly, $lm, $ld, $leapyes) {

		$temptd = 0;
		$dm = ($ly-1841)*12 + ($lm-1) -1;
		for($i=$dm;$i>=0;$i--) {
			switch($this->map[$i]) {
				case 1 :
					$temptd += 29;
					break;
				case 2 :
					$temptd += 30;
					break;
				case 3 :
					$temptd += 58;
					break;
				case 4 :
				case 5 :
					$temptd += 59;
					break;
				case 6 :
					$temptd += 60;
					break;    
			}
		}
		$dm = ($ly-1841)*12 + ($lm) -1;
		if($leapyes == "yoon") {
			switch($this->map[$dm]) {
				case 1 :
				case 2 : break;
				case 3 :
				case 4 :
					$temptd += 29;
					break;
				case 5 :
				case 6 :
					$temptd += 30;
					break;    
			}
		}

		$temptd += $ld;
		$temptd += 22;
		$td = $temptd;
		$tempsy = 1841;
		while(1) {
			list($this->md[1]) = $this->febdays($tempsy);
			for($tempsm=0;$tempsm<=11;$tempsm++) {
				$temptd -= $this->md[$tempsm];
				if($temptd <= 0) break;
			}
			if($temptd <= 0) {
				$temptd += $this->md[$tempsm];
				$tempsd = $temptd;
				break;
			}
			$tempsy++;
		}

		$sy = $tempsy;
		$sm = $tempsm + 1;
		$sd = $tempsd;
		$k1 = ($ly+6) % 10;
		$k2 = ($ly+8) % 12;
		$i = $td % 10;
		$j = $td % 12;
		$w = ($td+4) % 7;

//		return array($sy, $sm, $sd, $k1, $k2, $i, $j, $w, $yoon);
		return array(
			'year' => $sy,
			'month' => $sm,
			'day' => $sd,
			'gan' => $this->hgan[$k1],
			'jee' => $this->hjee[$k2],
//			$i,
//			$j,
			'weekday' => $w,
			'yoon' => $yoon
		);
	}
}


/* // Usage
$LC = new LunaCal;
print_r($LC->sol2lun(1979,2,22));
print_r($LC->lun2sol(2004,10,7,0));
*/
?>